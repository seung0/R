2020-07-07

R 9강

#확률변수와 확률분호

-어떤 변수 X의 값이 P(X)의 확률로 나오는 경우, X를 확률변수라고 한다.

-확률변수는 형태에 따라 이산확률변수와 연속확률변수가 있다.
 >이산확률변수 : 정수와 같이 연속되지 않고 뚝뚝 끊어지는 값을 갖는 변수
 >연속확률변수 : 실수와 같이 연속되어 있는 값을 갖는 변수

-확률분포는 확률변수가 특정 값을 가질 확률을 나타내는 함수로 표현한 것이다.
 >이산확률분포 : 이산확률변수가 가지는 확률분포 ex) 주사위 눈금이 나올 확률
 >연속확률분포 : 연속확률변수가 가지는 확률분포 ex) 성인남자 키가 170~175cm일 확률



#이산확률분포 (많이 사용되지 않는다.)

-이산확률변수는 각 이산값에 대한 확률을 계산할 수 있다.
 예를 들어 주사위 각 눈금은 1/6의 확률을 갖는다.
-이산확률변수 X의 확률 P(X)는 이산확률분포 f(x)를 따른다.
 P(X) = f(x)
-변수를 늘려갈수록 '정규분포'에 가까워진다.
 예를 들어 주사위를 2번 던지는 것보다 3번, 4번 던질수록 정규분포 형태와 비슷해짐



#연속확률분포

-이산확률변수와 달리 연속확률변수는 연속된 값을 가지면 연속확률분포를 따른다.
-특정 구간 안에서 연속확률변수 X의 확률 P(X)는 연속확률분포 f(x)를 적분한 값과 같다.

***평균이 0, 표준편차가 1인 표준정규분포 그래프 상에서 비율 외우기!
    ->0.1  2.1  13.6  34.1  34.1  13.6  2.1  0.1<-



#정규분포

-정규분포는 우리 주변에서 쉽게 발견할 수 있는 연속확률분포 중 하나이다.
 >분포의 형태는 좌우 대칭의 종모양으로 그려지고, 분포의 중앙은 평균이자 중위수가 된다.
 >예를 들어, 우리나라 20~59세 성인 남성을 전체 집합(모집단)이라고 가정할 때, 모집단에 속하는 사람들의 몸무게를 측정하면 평균 몸무게에 가장 많은 사람들이 모이게 된다.

-정규분포는 모집단의 평균과 표준편차를 알면 분포의 모양이 정해진다.
 >평균이 같아도 표준편차가 다르면 분포의 모양은 서로 다르다.
 >표준편차가 작을수록 평균 주변에 상대적으로 많은 데이터가 모이므로 뾰족한 종모양으로 그려지고,
  표준편차가 클수록 넓게 퍼진 종모양으로 그려진다.
 >이렇듯 모든 정규분포의 모양이 다 다른데, 이것들을 표준화시켜놓은 것이 표준정규분포이다. (평균 : 0, 분산 : 1)



#실습 : 정규분포 관련 함수

-rnorm() 함수는 정규분포를 따르는 임의의 숫자를 반환
 >library(tidyverse)
  set.seed(1234)
  hgts <- rnorm(1000, 170, 15)
  hgts <- rnorm(1000, 170, 10)
  hgts <- rnorm(1000, 170, 5)
  *표준편차가 작아질수록 정규분포 모양에 가까워지는 것을 확인할 수 있다. 

  range(hgts)
  breaks <- seq(100, 230, 1)
  hist(hgts, breaks =  breaks)
  *히스토그램을 그려서 정규분포 모양에 가까운지 확인할 수 있다. 


-pnorm() 함수는 특정 관측값에 대해 정규분포에서의 확률을 반환
 >pnorm(q = 180, mean = 170, sd = 15)     --> 0.7475075
  pnorm(q = 180, mean = 170, sd = 10)     --> 0.8413447
  pnorm(q = 180, mean = 170, sd = 5)      --> 0.9772499
  pnorm(q = 186, mean = 175.6, sd = 5.3)  --> 0.9751341
*우리나라 성인 남성의 평균키가 175.6이고 표준편차가 5.3일 때, 186인 남자는 몇 퍼센트에 위치하는가를 알 수 있다.
*표준편차가 작아질수록 상위 확률에 위치하게 된다.



-qnorm() 함수는 정규분포에서의 확률에 대해 해당 관측값을 반환
 >qnorm(p =  0.7475075, mean = 170, sd = 15) --> 180
  qnorm(p =  0.8413447, mean = 170, sd = 10) --> 180
  qnorm(p =  0.9772499, mean = 170, sd = 5)  --> 180
  qnorm(p =  0.9772499, mean = 170, sd = 15) --> 200
 *표준편차가 클수록 같은 확률에 위치하는 값이 크다.



-dnorm() 함수는 특정 관측값에 대해 y축의 값인 밀도를 반환
 >dnorm(180, mean = 170, sd = 15)
  dnorm(180, mean = 170, sd = 10)
 *곡선에서의 높이를 나타냄
  표준편차가 작을수록 값이 커진다.




#표준정규분포

-2개 이상의 확률변수가 정규분포를 따른다고 가정할 때, 두 확률변수는 평균과 표준편차가 서로 다르므로 현재 상태로 직접 비교하는 것은 어렵다.
 하지만 두 확률변수의 평균이 0이고, 표준편차가 1인 표준정규분포를 따르도록 표준화하면 직접 비교가 가능해진다.
 >표준화 방법은 각 확률변수의 값에서 평균을 뺀 다음 표준편차로 나눈 z-score로 변환하는 것이다.
 >z-score는 평균이 0, 표준편차가 1인 표준정규분포를 따른다.

*그래프의 모양은 다 같은 형태로 보이지만 특정 변수에 대한 z-score는 다르다.


#실습 : 데이터 표준화
-3가지 서로 다른 정규분포를 따르는 관측값에 대한 표준화된 값을 비교한다.
 >scale(x = 180, center = 170, scale = 15) --> 0.666
  scale(x = 180, center = 170, scale = 10) --> 1
  scale(x = 180, center = 170, scale = 5)  --> 2
 *표준편차가 작을수록 표준화시키면 값이 커진다.

-수학 : 90점 (평균 75, 표준편차 15)
 영어 : 55점 (평균 40, 표준편차 10) 
 >scale(90, 75, 15) --> 1
  scale(55, 40, 10) --> 1.5
 *영어 시험을 수학 시험보다 잘 본 것!



#chi-square 분포

-카이제곱 분포는 k개의 서로 독립적인 표준정규분포를 따르는 확률변수를 각각 제곱하여 모두 더한 값으로 얻은 분포이다.
 (k는 카이제곱 분포의 자유도)
-자유도에 따라 분포의 모양이 크게 달라지는데, 자유도가 증가할수록 정규분포에 가까워진다.

 *분산이 따름!


#스튜던트 t 분포 (2개 그룹의 평균이 같은지?)

-스튜던트 t 분포는 (정규분포하는) 표본의 평균으로 모집단의 평균을 추정할 때 사용된다.
-t분포는 자유도의 크기에 커질수록 모양이 표준정규분포에 가까워진다. (sample 수가 많을수록)
-t검정 및 회귀계수의 유의성 검정을 할 때 t 통계량이 사용된다.
*귀무가설('두 그룹이 같다') 성립하면 변수를 고려할 필요가 없다.


#F 분포 (3개 이상의 평균 비교)

-F분포는 카이제곱 분포를 따르는 두 개의 확률값을 각각의 자유도로 나눈 후 다시 나눈 값으로 얻은 분포이다.
-F분포는 ANOVA에서 집단 간 변동과 집단 내 변동의 평균을 비교할 때 활용된다.
-회귀모형의 유의성 검정을 할 때 F분포가 활용된다.

*값 차이가 많이 날수록 그래프 모양이 멀어진다.



#통계적 가설검정

-통계적 가설검정은 어떤 주장에 대해 모수를 이용하여 해당 주장이 합당한 것인지를 판단하는 과정을 의미한다.
 (모수는 모집단의 특성인데, 전체 모집단 대신 표본을 추출하여 표본의 특성으로 모수를 추정한다.)
-통계적 가설검정의 과정
 >귀무가설(null hypothesis)과 대립가설(alternative hypothesis)를 설정
 >유의수준과 기각역을 설정 (유의수준은 참인 귀무가설을 기각하는 위험을 뜻한다.)
 >검정통계량('증거') 및 유의확률('증거가 나타날 확률')을 계산한다. 
  (표본의 확률분포에 따라 유의확률이 결정된다.)
 >유의확률이 기각역 바깥에 위치하면 귀무가설을 기각한다.

*유의확률을 보고 기각할지 말지 결정한다. -> 유의수준 안에 들어오면 귀무가설 유지, 밖으로 나가면 기각
***유의확률이 0.05보다 작으면 귀무가설 기각!!!

#대립가설 : 채택하고자 하는 가설
#유의수준을 0.05로 설정하는 경우 : 양측검정일 때 양쪽 기각역은 각 0.025가 되고, 단측검정일 때 해당 기각역과 유의수준이 같으므로 0.05가 된다.
#유의수준은 귀무가설이 참이지만 기각하는 위험을 감내하는 수준을 의미한다. 
#검정통계량이 기각역 바깥에 위치하는 경우 귀무가설을 기각하게 된다.




#상관성 분석 -> '변수 간에 서로 관련이 있는지 없는지'

-컴퓨터의 성능이 크게 향상되었고, 빅데이터 시대가 도래함에 따라 많은 기업들이 자산으로서 데이터의 중요성에 대해 인식하게 되었다.
 그에 따라 기업은 과거보다 많은 데이터 규모를 확보하게 되었다.
-그 결과 과거에 비해 모형 적합에 사용할 수 있는 입력변수(input variable)의 수가 크게 증가하였지만, 이는 연산 비용의 증가로 연걸된다.
-적합도가 높은 모형의 생성을 위해, 목표변수(target variable)와 상관성이 있는 입력변수를 선택함으로써 작업 효율을 높일 수 있다.
*탐색적 데이터 분석의 일환으로 상관성 분석을 매번 실시하는 것이 좋다.


#분석데이터의 특징

-Toyota 중고차에 대한 다양한 입력변수로 중고차 가격을 추정하는 선형회귀모형을 적합하기에 앞서 목표변수(중고차 가격)와 입력변수 간 관계를 파악한다.
-데이터셋의 주요 변수별 상세 내용에는 여러 가지가 있다.
 >Price : 중고차 가격
 >Age : 중고차 개월 수           --> 개월 수와 가격은 상관계수로 관계 파악
 >KM : 주행거리
 >FuelType : 연료의 종류         --> 연료의 종류와 가격은 아노바로 관계 파악
 >HP : 마력
 >MetColor : 색상(0/1)
 >Automatic : 미션의 종류(0/1)
 >CC : 엔진의 크기
 >Doors : 차량 문의 갯수
 >Weight : 차량 무게



#분석 데이터 불러오기

>library(tidyverse)
 df <- read.csv(file = 'http://bit.ly/toyota_price', header = TRUE)
 
>str(df)
 head(df, 10L)
 summary(df)
*불러온 데이터프레임 구조 파악


#입력변수 속성 변환하기
>df[4, 6:7] <- map_df(df[4, 6:7], as.factor)
*현재 숫자형 벡터로 저장되어 있는 명목형 벡터는 범주형(factor)으로 변경한다.
 map_df() 함수를 이용하는 방법이 실용적이다.

 

#목표변수 파악하기

-다양한 시각화 함수를 통해 목표변수(Price)의 분포를 파악한다. 
>hist(df$Price, col = 'gray70')
 boxplot(df$Price)

-목표변수와 연속형 입력변수 'Age'간 관계를 확인한다.
>plot(formula = Price ~ Age,
      data = df,
      pch = 19,
      col = 'gray70')

-목표변수와 연속형 입력변수 'KM'간 관계를 확인한다.
>plot(formula = Price ~ KM,
      data = df,
      pch = 19,
      col = 'gray70')

-목표변수와 연속형 입력변수 'Weight'간 관계를 확인한다.
>plot(formula = Price ~ Weight,
      data = df,
      pch = 19,
      col = 'gray70')
>abline(v = 1350m
        col = 'red',
        lty = 2)



-목표변수와 연속형 입력변수 'HP'간 관계를 확인한다.
>plot(formula = Price ~ HP,
      data = df,
      pch = 19,
      col = 'gray70')
>avg <- df %>%
  group_by(HP) %>%
  summarise(m = mean(Price))
>points(avg$HP, avg$m,
        phc = 19,
        col = 'red',
        cex = 1.5)



-목표변수와 연속형 입력변수 'CC'간 관계를 확인한다.
>plot(formula = Price ~ CC,
      data = df,
      pch = 19,
      col = 'gray70')
>avg <- df %>%
  group_by(CC) %>%
  summarise(m = mean(Price))
>points(avg$CC, avg$m,
        phc = 19,
        col = 'red',
        cex = 1.5)



-목표변수와 연속형 입력변수 'Doors'간 관계를 확인한다.
>plot(formula = Price ~ Doors,
      data = df,
      pch = 19,
      col = 'gray70')
>avg <- df %>%
  group_by(Doors) %>%
  summarise(m = mean(Price))
>points(avg$Doors, avg$m,
        phc = 19,
        col = 'red',
        cex = 1.5)


-목표변수와 연속형 입력변수 'FuelType'간 관계를 확인한다.
>barplot(formula = Price ~ FuelType,
         data = df,
         pch = 19,
         col = 'gray70')
>avg <- df %>%
  group_by(FuelType) %>%
  summarise(m = mean(Price))
>points(avg$FuelType, avg$m,
        phc = 19,
        col = 'red',
        cex = 1.5)



-목표변수와 연속형 입력변수 'MetColor'간 관계를 확인한다.
>barplot(formula = Price ~ MetColor,
         data = df,
         pch = 19,
         col = 'gray70')
>avg <- df %>%
  group_by(MetColor) %>%
  summarise(m = mean(Price))
>points(avg$MetColor, avg$m,
        phc = 19,
        col = 'red',
        cex = 1.5)




-목표변수와 연속형 입력변수 'Automatic'간 관계를 확인한다.
>barplot(formula = Price ~ Automatic,
         data = df,
         pch = 19,
         col = 'gray70')
>avg <- df %>%
  group_by(Automatic) %>%
  summarise(m = mean(Price))
>points(avg$Automatic, avg$m,
        phc = 19,
        col = 'red',
        cex = 1.5)



#목표변수 파악하기
-'df'의 일부 조건을 만족하는 행을 삭제한다.
>df <- df %>%
  filter(HP <= 120 & Weight <= 1350 & Doors >= 3)






























